<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badass Guitar Practice Tracker!</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        h1, h2, h3 {
            color: #3949ab;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], 
        input[type="number"],
        input[type="date"],
        input[type="email"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #3949ab;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #303f9f;
        }
        .stats {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            flex: 1;
            text-align: center;
        }
        .sessions {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table th, table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
        }
        .tab.active {
            border-bottom: 2px solid #3949ab;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .technique-item, .song-item {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .progress-bar {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }
        .progress-fill {
            height: 100%;
            background: #3949ab;
        }
        .delete-btn {
            background: #f44336;
            padding: 5px 10px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-btn:hover {
            background: #d32f2f;
        }
        .timer-btn {
            color: white;
            border: none;
            padding: 8px 15px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .timer-btn:hover {
            opacity: 0.9;
        }
        .timer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .settings-group {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        .help-text {
            font-size: 0.85rem;
            color: #666;
            margin-top: 3px;
        }

        .data-management-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
        }
        .user-controls {
            display: flex;
            align-items: center;
        }
        .current-user {
            margin-right: 10px;
            font-weight: bold;
        }
        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .time-allocation-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }

        .slider-container {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .slider-label span:last-child {
            font-weight: bold;
        }

        .time-slider {
            width: 100%;
            margin-top: 5px;
        }

        .time-allocation-summary {
            margin-top: 15px;
            padding: 10px;
            background-color: #e0e7ff;
            border-radius: 4px;
            font-weight: bold;
        }

        .allocation-warning {
            color: #f44336;
            font-weight: bold;
            display: none;
        }

        .delete-item-btn {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 2px 6px;
            margin-left: 10px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .delete-item-btn:hover {
            background: #d32f2f;
        }

        .song-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* New styles for Firebase authentication */
        .auth-form {
            text-align: left;
        }
        .form-switch {
            margin-top: 15px;
            font-size: 0.9rem;
        }
        .auth-btn {
            background-color: #3949ab;
            color: white;
            border: none;
            padding: 10px 15px;
            width: 100%;
            margin-top: 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .auth-btn:hover {
            background-color: #303f9f;
        }
        .auth-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .auth-message.error {
            background-color: #ffebee;
            color: #c62828;
            display: block;
        }
        .auth-message.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            display: block;
        }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>

<!-- Firebase Authentication Login Screen -->
<div id="login-screen" class="login-container">
    <h2>Guitar Practice Tracker V1.3</h2>
    <p>Sign in to track your practice across devices</p>
    
    <div id="auth-forms">
        <!-- Login Form -->
        <div id="login-form" class="auth-form">
            <h3>Login</h3>
            <div class="form-group">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" placeholder="Your email" required>
            </div>
            <div class="form-group">
                <label for="login-password">Password</label>
                <input type="password" id="login-password" placeholder="Your password" required>
            </div>
            <button id="login-btn" class="auth-btn">Login</button>
            <p class="form-switch">Don't have an account? <a href="#" id="show-signup">Sign up</a></p>
        </div>
        
        <!-- Signup Form -->
        <div id="signup-form" class="auth-form" style="display: none;">
            <h3>Create Account</h3>
            <div class="form-group">
                <label for="signup-email">Email</label>
                <input type="email" id="signup-email" placeholder="Your email" required>
            </div>
            <div class="form-group">
                <label for="signup-password">Password</label>
                <input type="password" id="signup-password" placeholder="Your password" required>
                <p class="help-text">Use at least 6 characters</p>
            </div>
            <button id="signup-btn" class="auth-btn">Create Account</button>
            <p class="form-switch">Already have an account? <a href="#" id="show-login">Login</a></p>
        </div>
    </div>
    
    <div id="auth-message" class="auth-message"></div>
</div>

<!-- Main App Container -->
<div class="container">
    <header>
        <h1>Badass Guitar Practice Tracker</h1>
        <div class="navbar">
            <div class="user-controls">
                <span class="current-user" id="current-user-display"></span>
                <button class="logout-btn" id="logout-btn">Logout</button>
            </div>
        </div>
    </header>

    <div class="stats">
        <div class="stat-card">
            <h3>Total Practice</h3>
            <p id="total-time">0 minutes</p>
        </div>
        <div class="stat-card">
            <h3>Sessions</h3>
            <p id="session-count">0</p>
        </div>
        <div class="stat-card">
            <h3>Current Streak</h3>
            <p id="current-streak">0 days</p>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="log">Log Practice</div>
        <div class="tab" data-tab="techniques">Techniques</div>
        <div class="tab" data-tab="songs">Songs</div>
        <div class="tab" data-tab="history">History</div>
        <div class="tab" data-tab="reports">Reports</div>
        <div class="tab" data-tab="settings">Settings</div>
    </div>

    <div id="log-tab" class="tab-content active">
        <h2>Log Practice Session</h2>
        <div class="timer-container" style="margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 8px;">
            <h3>Practice Timer</h3>
            <div class="timer-display" style="font-size: 2rem; font-weight: bold; margin: 10px 0;">00:00:00</div>
            <div class="timer-controls">
                <button id="start-timer" class="timer-btn" style="background-color: #4caf50;">Start</button>
                <button id="pause-timer" class="timer-btn" style="background-color: #ff9800;" disabled>Pause</button>
                <button id="stop-timer" class="timer-btn" style="background-color: #f44336;" disabled>Stop</button>
            </div>
        </div>
        <form id="practice-form">
            <div class="form-group">
                <label for="date">Date</label>
                <input type="date" id="date" required>
            </div>
            <div class="form-group">
                <label for="duration">Duration (minutes)</label>
                <input type="number" id="duration" min="1" value="30" required>
            </div>
            <div class="form-group">
                <label>Techniques Practiced</label>
                <div id="technique-checkboxes"></div>
            </div>
            <div class="form-group">
                <label>Songs Practiced</label>
                <div id="song-checkboxes"></div>
            </div>
            
            <div class="time-allocation-container">
                <h3>Time Allocation</h3>
                <p>Drag the sliders to allocate your practice time between techniques and songs.</p>
                <p class="allocation-warning" id="allocation-warning">Total allocation doesn't match session duration!</p>
                <div id="allocation-sliders">
                    <!-- Sliders will be generated here by JavaScript -->
                </div>
                <div class="time-allocation-summary">
                    <div>Total Allocated: <span id="total-allocated">0</span> minutes</div>
                    <div>Remaining: <span id="remaining-time">30</span> minutes</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" rows="3"></textarea>
            </div>
            <button type="submit">Save Practice Session</button>
        </form>
    </div>

    <div id="techniques-tab" class="tab-content">
        <h2>Techniques</h2>
        <div class="form-group">
            <input type="text" id="new-technique" placeholder="Add new technique...">
            <button id="add-technique-btn">Add</button>
        </div>
        <div id="techniques-list"></div>
    </div>

    <div id="songs-tab" class="tab-content">
        <h2>Songs</h2>
        <div class="form-group">
            <input type="text" id="new-song" placeholder="Add new song...">
            <button id="add-song-btn">Add</button>
        </div>
        <div id="songs-list"></div>
    </div>

    <div id="history-tab" class="tab-content">
        <h2>Practice History</h2>
        <table id="history-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Duration</th>
                    <th>Techniques</th>
                    <th>Songs</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="history-body"></tbody>
        </table>
    </div>

    <div id="reports-tab" class="tab-content">
        <h2>Practice Reports</h2>
        <div class="chart-container" style="position: relative; height:50vh; width:100%">
            <canvas id="weekly-chart"></canvas>
        </div>
        <div class="chart-container" style="position: relative; height:50vh; width:100%; margin-top: 30px;">
            <canvas id="technique-chart"></canvas>
        </div>
    </div>

    <div id="settings-tab" class="tab-content">
        <h2>Settings</h2>
        
        <div class="settings-group">
            <h3>Progress Requirements</h3>
            <div class="form-group">
                <label for="level-up-minutes">Minutes to Level Up a Technique</label>
                <input type="number" id="level-up-minutes" min="1" value="60">
                <p class="help-text">Time required to advance a technique by 1 level (max 10)</p>
            </div>
            
            <div class="form-group">
                <label for="song-completion-minutes">Minutes to Complete a Song</label>
                <input type="number" id="song-completion-minutes" min="1" value="120">
                <p class="help-text">Time required to reach 100% completion on a song</p>
            </div>
        </div>
        
        <div class="settings-group">
            <h3>Goals & Streaks</h3>
            <div class="form-group">
                <label for="streak-threshold">Minimum Minutes for Streak</label>
                <input type="number" id="streak-threshold" min="1" value="1">
                <p class="help-text">Minimum practice time for a day to count toward your streak</p>
            </div>
            
            <div class="form-group">
                <label for="weekly-goal">Weekly Practice Goal (minutes)</label>
                <input type="number" id="weekly-goal" min="1" value="210">
                <p class="help-text">Your target practice time each week</p>
            </div>
        </div>
        
        <button id="save-settings-btn">Save Settings</button>

        <div class="settings-group">
            <h3>Data Management</h3>
            <p>Back up your practice data or restore from a previous backup:</p>
            <div class="data-management-buttons">
                <button id="export-data-btn">Export Data</button>
                <button id="import-data-btn">Import Data</button>
            </div>
            <input type="file" id="import-file" style="display: none;" accept=".json">
        </div>
    </div>
</div>

<!-- Firebase SDK scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
    
    // Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyC5rjogSXv_7BJ5mT58PIJoi-BWedce4wc",
  authDomain: "guitar-practice-tracker.firebaseapp.com",
  projectId: "guitar-practice-tracker",
  storageBucket: "guitar-practice-tracker.firebasestorage.app",
  messagingSenderId: "182882362321",
  appId: "1:182882362321:web:770004d821d23a749836f0",
  measurementId: "G-8Z7KLKKV14"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Get references to Firebase services
    const auth = firebase.auth();
    const db = firebase.firestore();
</script>
<script>
    // Simple data store
    let practiceData = {
        sessions: [],
        techniques: [
            { id: 1, name: 'Scales', level: 0 },
            { id: 2, name: 'Chords', level: 0 },
            { id: 3, name: 'Fingerpicking', level: 0 }
        ],
        songs: [
            { id: 1, name: 'Example Song 1', progress: 0 },
            { id: 2, name: 'Example Song 2', progress: 0 }
        ],
        settings: {
            levelUpMinutes: 60,
            songCompletionMinutes: 120,
            streakThreshold: 1,
            goalMinutesPerWeek: 210
        }
    };
    
    // Add the timer variable declaration
    let timer = {
        running: false,
        interval: null,
        seconds: 0,
        display: null,
        startBtn: null,
        pauseBtn: null,
        stopBtn: null
    };

    // Current user variable
    let currentUser = null;

    // Firebase Authentication Functions
    function signUp(email, password) {
    // Add console logs for debugging
    console.log("Attempting to sign up with:", email);
    
    return firebase.auth().createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
            console.log("User created successfully", userCredential.user);
            // Create user document in Firestore
            return firebase.firestore().collection('users').doc(userCredential.user.uid).set({
                email: email,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                practiceData: {
                    sessions: [],
                    techniques: [
                        { id: 1, name: 'Scales', level: 0 },
                        { id: 2, name: 'Chords', level: 0 },
                        { id: 3, name: 'Fingerpicking', level: 0 }
                    ],
                    songs: [
                        { id: 1, name: 'Example Song 1', progress: 0 },
                        { id: 2, name: 'Example Song 2', progress: 0 }
                    ],
                    settings: {
                        levelUpMinutes: 60,
                        songCompletionMinutes: 120,
                        streakThreshold: 1,
                        goalMinutesPerWeek: 210
                    }
                }
            });
        })
        .then(() => {
            console.log("User data created in Firestore");
            return true;
        })
        .catch((error) => {
            console.error("Error creating user:", error.code, error.message);
            throw error;
        });
}
    function signIn(email, password) {
        return auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                console.log("User signed in successfully");
                currentUser = userCredential.user.uid;
                return loadUserData();
            })
            .catch((error) => {
                console.error("Error signing in:", error);
                throw error;
            });
    }

    function signOut() {
        return auth.signOut()
            .then(() => {
                console.log("User signed out successfully");
                currentUser = null;
                return true;
            })
            .catch((error) => {
                console.error("Error signing out:", error);
                throw error;
            });
    }

    // Firebase Data Functions
    function loadUserData() {
        if (!currentUser) return Promise.reject("No user logged in");
        
        return db.collection('users').doc(currentUser).get()
            .then((doc) => {
                if (doc.exists && doc.data().practiceData) {
                    practiceData = doc.data().practiceData;
                    
                    // Set today's date as default
                    document.getElementById('date').valueAsDate = new Date();
                    
                    renderApp();
                    return practiceData;
                } else {
                    console.log("No practice data found or first time user.");
                    // Initialize with default data for new users
                    return saveUserData(); // This will create the initial data structure
                }
            })
            .catch((error) => {
                console.error("Error loading user data:", error);
                throw error;
            });
    }

    function saveUserData() {
        if (!currentUser) return Promise.reject("No user logged in");
        
        return db.collection('users').doc(currentUser).update({
            practiceData: practiceData
        })
        .then(() => {
            console.log("User data saved successfully");
            return true;
        })
        .catch((error) => {
            // Handle the case where the document doesn't exist yet
            if (error.code === 'not-found') {
                return db.collection('users').doc(currentUser).set({
                    practiceData: practiceData,
                    email: auth.currentUser.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            console.error("Error saving user data:", error);
            throw error;
        });
    }

    // Authentication UI Helpers
    function showAuthMessage(message, type) {
        const messageElement = document.getElementById('auth-message');
        messageElement.textContent = message;
        messageElement.className = 'auth-message ' + type;
    }

    function clearAuthMessage() {
        const messageElement = document.getElementById('auth-message');
        messageElement.textContent = '';
        messageElement.className = 'auth-message';
    }

    // UI Control Functions
    function showLoginScreen() {
        document.getElementById('login-screen').style.display = 'block';
        document.querySelector('.container').style.display = 'none';
    }

    function showApp() {
        document.getElementById('login-screen').style.display = 'none';
        document.querySelector('.container').style.display = 'block';
        
        // Update user display
        if (auth.currentUser) {
            document.getElementById('current-user-display').textContent = auth.currentUser.email;
        }
    }

    // Calculate stats
    function calculateStats() {
        // Total practice time
        const totalMinutes = practiceData.sessions.reduce((total, session) => 
            total + Number(session.duration), 0);
        document.getElementById('total-time').textContent = `${totalMinutes} minutes`;
        
        // Session count
        document.getElementById('session-count').textContent = practiceData.sessions.length;
        
        // Current streak
        const streak = calculateStreak();
        document.getElementById('current-streak').textContent = `${streak} days`;
    }

    // Calculate streak
    function calculateStreak() {
        if (practiceData.sessions.length === 0) return 0;
        
        // Group sessions by date
        const sessionsByDate = {};
        practiceData.sessions.forEach(session => {
            const date = new Date(session.date).toISOString().split('T')[0];
            sessionsByDate[date] = (sessionsByDate[date] || 0) + Number(session.duration);
        });
        
        // Get valid dates meeting threshold
        const validDates = Object.entries(sessionsByDate)
            .filter(([_, duration]) => duration >= practiceData.settings.streakThreshold)
            .map(([date]) => date)
            .sort()
            .reverse();
            
        if (validDates.length === 0) return 0;
        
        // Check if practiced today or yesterday
        const today = new Date().toISOString().split('T')[0];
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        if (validDates[0] !== today && validDates[0] !== yesterdayStr) {
            return 0; // Streak broken
        }
        
        // Count consecutive days
        let streak = 1;
        for (let i = 0; i < validDates.length - 1; i++) {
            const current = new Date(validDates[i]);
            const next = new Date(validDates[i + 1]);
            
            const diffDays = Math.ceil(
                Math.abs(current - next) / (1000 * 60 * 60 * 24)
            );
            
            if (diffDays === 1) {
                streak++;
            } else {
                break;
            }
        }
        
        return streak;
    }

    // Render the entire app
    function renderApp() {
        renderTechniqueCheckboxes();
        renderSongCheckboxes();
        renderTechniquesList();
        renderSongsList();
        renderHistory();
        calculateStats();
        loadSettings();
    }

    // Render technique checkboxes in the log form
    function renderTechniqueCheckboxes() {
        const container = document.getElementById('technique-checkboxes');
        container.innerHTML = '';
        
        practiceData.techniques.forEach(tech => {
            const checkbox = document.createElement('div');
            checkbox.innerHTML = `
                <label>
                    <input type="checkbox" data-tech-id="${tech.id}"> ${tech.name}
                </label>
            `;
            container.appendChild(checkbox);
        });
        
        // Add listeners to checkboxes
        document.querySelectorAll('#technique-checkboxes input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateTimeAllocationSliders);
        });
    }

    // Render song checkboxes in the log form
    function renderSongCheckboxes() {
        const container = document.getElementById('song-checkboxes');
        container.innerHTML = '';
        
        practiceData.songs.forEach(song => {
            const checkbox = document.createElement('div');
            checkbox.innerHTML = `
                <label>
                    <input type="checkbox" data-song-id="${song.id}"> ${song.name}
                </label>
            `;
            container.appendChild(checkbox);
        });
        
        // Add listeners to checkboxes
        document.querySelectorAll('#song-checkboxes input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateTimeAllocationSliders);
        });
    }

    // Function to update time allocation sliders based on selections
    function updateTimeAllocationSliders() {
        const container = document.getElementById('allocation-sliders');
        container.innerHTML = '';
        
        const duration = Number(document.getElementById('duration').value);
        let selectedItems = [];
        
        // Get selected techniques
        document.querySelectorAll('#technique-checkboxes input:checked').forEach(checkbox => {
            const techId = Number(checkbox.getAttribute('data-tech-id'));
            const tech = practiceData.techniques.find(t => t.id === techId);
            if (tech) {
                selectedItems.push({
                    id: techId,
                    name: tech.name,
                    type: 'technique',
                    allocation: 0
                });
            }
        });
        
        // Get selected songs
        document.querySelectorAll('#song-checkboxes input:checked').forEach(checkbox => {
            const songId = Number(checkbox.getAttribute('data-song-id'));
            const song = practiceData.songs.find(s => s.id === songId);
            if (song) {
                selectedItems.push({
                    id: songId,
                    name: song.name,
                    type: 'song',
                    allocation: 0
                });
            }
        });
        
        // If nothing selected, show message
        if (selectedItems.length === 0) {
            container.innerHTML = '<p>Select techniques and songs to allocate time.</p>';
            return;
        }
        
        // Distribute time evenly initially
        const evenAllocation = Math.floor(duration / selectedItems.length);
        let remaining = duration - (evenAllocation * selectedItems.length);
        
        selectedItems.forEach(item => {
            item.allocation = evenAllocation;
            if (remaining > 0) {
                item.allocation++;
                remaining--;
            }
        });
        
        // Create sliders for each item
        selectedItems.forEach((item, index) => {
            const sliderId = `slider-${item.type}-${item.id}`;
            const sliderDiv = document.createElement('div');
            sliderDiv.className = 'slider-container';
            sliderDiv.innerHTML = `
                <div class="slider-label">
                    <span>${item.name}</span>
                    <span id="value-${sliderId}">${item.allocation} min</span>
                </div>
                <input type="range" id="${sliderId}" class="time-slider" 
                       min="0" max="${duration}" value="${item.allocation}" 
                       data-index="${index}">
            `;
            container.appendChild(sliderDiv);
            
            // Add event listener to the slider
            document.getElementById(sliderId).addEventListener('input', function() {
                updateAllocationValues(selectedItems);
            });
        });
        
        // Store selected items for later use
        container.dataset.selectedItems = JSON.stringify(selectedItems);
        
        // Update summary
        updateAllocationSummary(selectedItems, duration);
    }
    
    // Function to update allocation values when sliders change
    function updateAllocationValues(selectedItems) {
        const sliders = document.querySelectorAll('.time-slider');
        const duration = Number(document.getElementById('duration').value);
        let total = 0;
        
        // Update each slider value display and collect total
        sliders.forEach(slider => {
            const index = Number(slider.getAttribute('data-index'));
            const value = Number(slider.value);
            selectedItems[index].allocation = value;
            
            document.getElementById(`value-${slider.id}`).textContent = `${value} min`;
            total += value;
        });
        
        // Update summary
        updateAllocationSummary(selectedItems, duration);
    }

    // Function to update allocation summary
    function updateAllocationSummary(selectedItems, duration) {
        const total = selectedItems.reduce((sum, item) => sum + item.allocation, 0);
        const remaining = duration - total;
        
        document.getElementById('total-allocated').textContent = total;
        document.getElementById('remaining-time').textContent = remaining;
        
        // Show warning if allocation doesn't match duration
        const warningElement = document.getElementById('allocation-warning');
        if (remaining !== 0) {
            warningElement.style.display = 'block';
        } else {
            warningElement.style.display = 'none';
        }
    }

    // Function to get time allocations from sliders
    function getTimeAllocations() {
        const container = document.getElementById('allocation-sliders');
        const selectedItemsJson = container.dataset.selectedItems;
        
        if (!selectedItemsJson) {
            return [];
        }
        
        const selectedItems = JSON.parse(selectedItemsJson);
        const allocations = [];
        
        selectedItems.forEach(item => {
            allocations.push({
                id: item.id,
                type: item.type,
                minutes: item.allocation
            });
        });
        
        return allocations;
    }
    
    // Render techniques list
    function renderTechniquesList() {
        const container = document.getElementById('techniques-list');
        container.innerHTML = '';
        
        practiceData.techniques.forEach(tech => {
            const techEl = document.createElement('div');
            techEl.className = 'technique-item';
            techEl.innerHTML = `
                <div class="song-list-item">
                    <div>
                        <span>${tech.name}</span>
                        <span>Level: ${tech.level.toFixed(1)}/10</span>
                    </div>
                    <button class="delete-item-btn" data-tech-id="${tech.id}">Delete</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${(tech.level / 10) * 100}%"></div>
                </div>
            `;
            container.appendChild(techEl);
        });
        
        // Add event listeners to delete buttons
        document.querySelectorAll('#techniques-list .delete-item-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const techId = Number(this.getAttribute('data-tech-id'));
                deleteTechnique(techId);
            });
        });
    }

    // Render songs list
    function renderSongsList() {
        const container = document.getElementById('songs-list');
        container.innerHTML = '';
        
        practiceData.songs.forEach(song => {
            const songEl = document.createElement('div');
            songEl.className = 'song-item';
            songEl.innerHTML = `
                <div class="song-list-item">
                    <div>
                        <span>${song.name}</span>
                        <span>${song.progress.toFixed(1)}% Complete</span>
                    </div>
                    <button class="delete-item-btn" data-song-id="${song.id}">Delete</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${song.progress}%"></div>
                </div>
            `;
            container.appendChild(songEl);
        });
        
        // Add event listeners to delete buttons
        document.querySelectorAll('#songs-list .delete-item-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const songId = Number(this.getAttribute('data-song-id'));
                deleteSong(songId);
            });
        });
    }
    
    // Render practice history
    function renderHistory() {
        const historyBody = document.getElementById('history-body');
        historyBody.innerHTML = '';
        
        [...practiceData.sessions].reverse().forEach(session => {
            const row = document.createElement('tr');
            
            // Get technique names with allocations
            let techNames = '';
            if (session.timeAllocations) {
                const techAllocations = session.timeAllocations.filter(a => a.type === 'technique');
                techNames = techAllocations.map(alloc => {
                    const tech = practiceData.techniques.find(t => t.id === alloc.id);
                    return tech ? `${tech.name} (${alloc.minutes}m)` : '';
                }).join(', ');
            } else {
                techNames = session.techniques.map(techId => {
                    const tech = practiceData.techniques.find(t => t.id === techId);
                    return tech ? tech.name : '';
                }).join(', ');
            }
            
            // Get song names with allocations
            let songNames = '';
            if (session.timeAllocations) {
                const songAllocations = session.timeAllocations.filter(a => a.type === 'song');
                songNames = songAllocations.map(alloc => {
                    const song = practiceData.songs.find(s => s.id === alloc.id);
                    return song ? `${song.name} (${alloc.minutes}m)` : '';
                }).join(', ');
            } else {
                songNames = session.songs.map(songId => {
                    const song = practiceData.songs.find(s => s.id === songId);
                    return song ? song.name : '';
                }).join(', ');
            }
            
            row.innerHTML = `
                <td>${session.date}</td>
                <td>${session.duration} minutes</td>
                <td>${techNames}</td>
                <td>${songNames}</td>
                <td>
                    <button class="delete-btn" data-session-id="${session.id}">Delete</button>
                </td>
            `;
            historyBody.appendChild(row);
        });
        
        // Add delete event listeners
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const sessionId = Number(this.getAttribute('data-session-id'));
                deleteSession(sessionId);
            });
        });
    }
    
    // Add new technique
    function addTechnique() {
        const input = document.getElementById('new-technique');
        const techniqueName = input.value.trim();
        
        if (techniqueName) {
            // Check if this technique name already exists (case-insensitive)
            const exists = practiceData.techniques.some(tech => 
                tech.name.toLowerCase() === techniqueName.toLowerCase()
            );
            
            if (exists) {
                alert(`A technique named "${techniqueName}" already exists!`);
                return;
            }
            
            // Add the new technique
            practiceData.techniques.push({
                id: Date.now(), // Use timestamp as unique ID
                name: techniqueName,
                level: 0
            });
            
            // Clear input field
            input.value = '';
            
            // Save and update UI
            saveUserData();
            renderApp();
        } else {
            alert('Please enter a technique name');
        }
    }

    // Add new song
    function addSong() {
        const input = document.getElementById('new-song');
        const songName = input.value.trim();
        
        if (songName) {
            // Check if this song name already exists (case-insensitive)
            const exists = practiceData.songs.some(song => 
                song.name.toLowerCase() === songName.toLowerCase()
            );
            
            if (exists) {
                alert(`A song named "${songName}" already exists!`);
                return;
            }
            
            // Add the new song
            practiceData.songs.push({
                id: Date.now(), // Use timestamp as unique ID
                name: songName,
                progress: 0
            });
            
            // Clear input field
            input.value = '';
            
            // Save and update UI
            saveUserData();
            renderApp();
        } else {
            alert('Please enter a song name');
        }
    }
    
    // Delete song
    function deleteSong(songId) {
        // Check if song exists
        const songIndex = practiceData.songs.findIndex(s => s.id === songId);
        if (songIndex === -1) return;
        
        const songName = practiceData.songs[songIndex].name;
        
        // Ask for confirmation
        if (!confirm(`Are you sure you want to delete "${songName}"? This will remove all progress data for this song.`)) {
            return;
        }
        
        // Remove the song
        practiceData.songs.splice(songIndex, 1);
        
        // Remove song from any sessions
        practiceData.sessions = practiceData.sessions.map(session => {
            // Remove song from songs array
            session.songs = session.songs.filter(id => id !== songId);
            
            // Remove song from timeAllocations if present
            if (session.timeAllocations) {
                session.timeAllocations = session.timeAllocations.filter(
                    alloc => !(alloc.type === 'song' && alloc.id === songId)
                );
            }
            
            return session;
        });
        
        // Save and update UI
        saveUserData();
        renderApp();
    }
    
    // Delete technique
    function deleteTechnique(techId) {
        // Check if technique exists
        const techIndex = practiceData.techniques.findIndex(t => t.id === techId);
        if (techIndex === -1) return;
        
        const techName = practiceData.techniques[techIndex].name;
        
        // Ask for confirmation
        if (!confirm(`Are you sure you want to delete "${techName}"? This will remove all progress data for this technique.`)) {
            return;
        }
        
        // Remove the technique
        practiceData.techniques.splice(techIndex, 1);
        
        // Remove technique from any sessions
        practiceData.sessions = practiceData.sessions.map(session => {
            // Remove technique from techniques array
            session.techniques = session.techniques.filter(id => id !== techId);
            
            // Remove technique from timeAllocations if present
            if (session.timeAllocations) {
                session.timeAllocations = session.timeAllocations.filter(
                    alloc => !(alloc.type === 'technique' && alloc.id === techId)
                );
            }
            
            return session;
        });
        
        // Save and update UI
        saveUserData();
        renderApp();
    }
    
    // Save practice session
    function savePracticeSession(e) {
        e.preventDefault();
        
        const date = document.getElementById('date').value;
        const duration = Number(document.getElementById('duration').value);
        const notes = document.getElementById('notes').value;
        
        // Get selected techniques
        const techniques = [];
        document.querySelectorAll('#technique-checkboxes input:checked').forEach(checkbox => {
            techniques.push(Number(checkbox.getAttribute('data-tech-id')));
        });
        
        // Get selected songs
        const songs = [];
        document.querySelectorAll('#song-checkboxes input:checked').forEach(checkbox => {
            songs.push(Number(checkbox.getAttribute('data-song-id')));
        });
        
        // Get time allocations
        const timeAllocations = getTimeAllocations();
        
        // Create new session
        const newSession = {
            id: Date.now(),
            date,
            duration,
            techniques,
            songs,
            notes,
            timeAllocations
        };
        
        // Add to sessions
        practiceData.sessions.push(newSession);
        
        // Update technique levels - Now using allocated time for each technique
        practiceData.techniques = practiceData.techniques.map(tech => {
            const techAllocation = timeAllocations.find(
                a => a.type === 'technique' && a.id === tech.id
            );
            
            if (techAllocation) {
                const levelIncrease = techAllocation.minutes / practiceData.settings.levelUpMinutes;
                return { 
                    ...tech, 
                    level: Math.min(tech.level + levelIncrease, 10) 
                };
            }
            return tech;
        });
        
        // Update song progress - Now using allocated time for each song
        practiceData.songs = practiceData.songs.map(song => {
            const songAllocation = timeAllocations.find(
                a => a.type === 'song' && a.id === song.id
            );
            
            if (songAllocation) {
                const progressIncrease = (songAllocation.minutes / practiceData.settings.songCompletionMinutes) * 100;
                return { 
                    ...song, 
                    progress: Math.min(song.progress + progressIncrease, 100) 
                };
            }
            return song;
        });
        
        // Reset form
        document.getElementById('duration').value = '30';
        document.getElementById('notes').value = '';
        document.querySelectorAll('#technique-checkboxes input').forEach(checkbox => {
            checkbox.checked = false;
        });
        document.querySelectorAll('#song-checkboxes input').forEach(checkbox => {
            checkbox.checked = false;
        });
        
        // Reset time allocation sliders
        document.getElementById('allocation-sliders').innerHTML = '';
        document.getElementById('allocation-sliders').dataset.selectedItems = '';
        document.getElementById('total-allocated').textContent = '0';
        document.getElementById('remaining-time').textContent = '30';
        document.getElementById('allocation-warning').style.display = 'none';
        
        saveUserData();
        renderApp();
    }

    // Delete session
    function deleteSession(sessionId) {
        const session = practiceData.sessions.find(s => s.id === sessionId);
        
        if (session) {
            // If the session has timeAllocations, use them to reverse progress
            if (session.timeAllocations && session.timeAllocations.length > 0) {
                // Reverse technique level increases
                practiceData.techniques = practiceData.techniques.map(tech => {
                    const techAllocation = session.timeAllocations.find(
                        a => a.type === 'technique' && a.id === tech.id
                    );
                    
                    if (techAllocation) {
                        const levelDecrease = techAllocation.minutes / practiceData.settings.levelUpMinutes;
                        return {
                            ...tech,
                            level: Math.max(0, tech.level - levelDecrease)
                        };
                    }
                    return tech;
                });
                
                // Reverse song progress
                practiceData.songs = practiceData.songs.map(song => {
                    const songAllocation = session.timeAllocations.find(
                        a => a.type === 'song' && a.id === song.id
                    );
                    
                    if (songAllocation) {
                        const progressDecrease = (songAllocation.minutes / practiceData.settings.songCompletionMinutes) * 100;
                        return {
                            ...song,
                            progress: Math.max(0, song.progress - progressDecrease)
                        };
                    }
                    return song;
                });
            } else {
                // Fallback to the original method if timeAllocations aren't available
                // Reverse technique level increases
                practiceData.techniques = practiceData.techniques.map(tech => {
                    if (session.techniques.includes(tech.id)) {
                        const levelDecrease = session.duration / practiceData.settings.levelUpMinutes;
                        return {
                            ...tech,
                            level: Math.max(0, tech.level - levelDecrease)
                        };
                    }
                    return tech;
                });
                
                // Reverse song progress
                practiceData.songs = practiceData.songs.map(song => {
                    if (session.songs.includes(song.id)) {
                        const progressDecrease = (session.duration / practiceData.settings.songCompletionMinutes) * 100;
                        return {
                            ...song,
                            progress: Math.max(0, song.progress - progressDecrease)
                        };
                    }
                    return song;
                });
            }
            
            // Remove session
            practiceData.sessions = practiceData.sessions.filter(s => s.id !== sessionId);
            
            saveUserData();
            renderApp();
        }
    }

    // Timer functionality
    function setupTimer() {
        timer.display = document.querySelector('.timer-display');
        timer.startBtn = document.getElementById('start-timer');
        timer.pauseBtn = document.getElementById('pause-timer');
        timer.stopBtn = document.getElementById('stop-timer');
        
        timer.startBtn.addEventListener('click', startTimer);
        timer.pauseBtn.addEventListener('click', pauseTimer);
        timer.stopBtn.addEventListener('click', stopTimer);
    }

    function startTimer() {
        timer.running = true;
        timer.startBtn.disabled = true;
        timer.pauseBtn.disabled = false;
        timer.stopBtn.disabled = false;
        
        timer.interval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
        timer.seconds++;
        const hours = Math.floor(timer.seconds / 3600);
        const minutes = Math.floor((timer.seconds % 3600) / 60);
        const secs = timer.seconds % 60;
        
        timer.display.textContent = `${pad(hours)}:${pad(minutes)}:${pad(secs)}`;
    }

    function pad(num) {
        return num.toString().padStart(2, '0');
    }

    function pauseTimer() {
        timer.running = false;
        timer.startBtn.disabled = false;
        timer.pauseBtn.disabled = true;
        
        clearInterval(timer.interval);
    }

    function stopTimer() {
        const minutes = Math.floor(timer.seconds / 60);
        document.getElementById('duration').value = minutes;
        
        pauseTimer();
        timer.seconds = 0;
        timer.display.textContent = '00:00:00';
        timer.stopBtn.disabled = true;
        
        // Update sliders when duration changes
        updateTimeAllocationSliders();
    }
    
    // Charts and Reports functions
    function renderReports() {
        // Weekly practice chart
        renderWeeklyChart();
        
        // Technique distribution chart
        renderTechniqueChart();
    }

    function renderWeeklyChart() {
        const ctx = document.getElementById('weekly-chart');
        
        // Get last 4 weeks of data
        const now = new Date();
        const fourWeeksAgo = new Date();
        fourWeeksAgo.setDate(now.getDate() - 28);
        
        // Create an array of the last 4 weeks
        const weeks = [];
        for (let i = 0; i < 4; i++) {
            const startDate = new Date(fourWeeksAgo);
            startDate.setDate(startDate.getDate() + (i * 7));
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 6);
            weeks.push({
                start: startDate,
                end: endDate,
                label: `Week ${i+1}`,
                minutes: 0
            });
        }
        
        // Fill in the minutes practiced each week
        practiceData.sessions.forEach(session => {
            const sessionDate = new Date(session.date);
            if (sessionDate >= fourWeeksAgo) {
                for (const week of weeks) {
                    if (sessionDate >= week.start && sessionDate <= week.end) {
                        week.minutes += Number(session.duration);
                        break;
                    }
                }
            }
        });
        
        // Create the chart
        if (window.weeklyChart) {
            window.weeklyChart.destroy();
        }
        
        window.weeklyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: weeks.map(w => w.label),
                datasets: [{
                    label: 'Minutes Practiced',
                    data: weeks.map(w => w.minutes),
                    backgroundColor: 'rgba(57, 73, 171, 0.7)',
                    borderColor: 'rgba(57, 73, 171, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Weekly Practice Time'
                    },
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Minutes'
                        }
                    }
                }
            }
        });
    }

    function renderTechniqueChart() {
        const ctx = document.getElementById('technique-chart');
        
        // Count sessions with each technique
        const techniqueData = {};
        practiceData.techniques.forEach(tech => {
            techniqueData[tech.id] = {
                name: tech.name,
                count: 0
            };
        });
        
        practiceData.sessions.forEach(session => {
            session.techniques.forEach(techId => {
                if (techniqueData[techId]) {
                    techniqueData[techId].count++;
                }
            });
        });
        
        // Create the chart
        if (window.techniqueChart) {
            window.techniqueChart.destroy();
        }
        
        window.techniqueChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: Object.values(techniqueData).map(t => t.name),
                datasets: [{
                    data: Object.values(techniqueData).map(t => t.count),
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(153, 102, 255, 0.7)',
                        'rgba(255, 159, 64, 0.7)',
                        'rgba(199, 199, 199, 0.7)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Technique Practice Distribution'
                    },
                    legend: {
                        position: 'right'
                    }
                }
            }
        });
    }
    
    // Settings Functions
    function loadSettings() {
        // Load settings from practiceData
        document.getElementById('level-up-minutes').value = practiceData.settings.levelUpMinutes;
        document.getElementById('song-completion-minutes').value = practiceData.settings.songCompletionMinutes;
        document.getElementById('streak-threshold').value = practiceData.settings.streakThreshold;
        document.getElementById('weekly-goal').value = practiceData.settings.goalMinutesPerWeek || 210;
        
        // Add settings to practiceData if it doesn't exist
        if (!practiceData.settings.goalMinutesPerWeek) {
            practiceData.settings.goalMinutesPerWeek = 210;
        }
    }

    function saveSettings() {
        practiceData.settings.levelUpMinutes = Number(document.getElementById('level-up-minutes').value);
        practiceData.settings.songCompletionMinutes = Number(document.getElementById('song-completion-minutes').value);
        practiceData.settings.streakThreshold = Number(document.getElementById('streak-threshold').value);
        practiceData.settings.goalMinutesPerWeek = Number(document.getElementById('weekly-goal').value);
        
        saveUserData();
        alert('Settings saved!');
        
        // Recalculate stats since streak threshold might have changed
        calculateStats();
    }

    // Data Export/Import Functions
    function exportData() {
        // Create a JSON string of the data
        const dataStr = JSON.stringify(practiceData);
        
        // Create a download link
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileName = 'guitar_practice_data_' + new Date().toISOString().split('T')[0] + '.json';
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileName);
        linkElement.style.display = 'none';
        
        document.body.appendChild(linkElement);
        linkElement.click();
        document.body.removeChild(linkElement);
    }

    function importData() {
        document.getElementById('import-file').click();
    }

    function handleFileSelect(event) {
        const file = event.target.files[0];
        
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (importedData.sessions && importedData.techniques && importedData.songs && importedData.settings) {
                        // Confirm before overwriting
                        if (confirm('This will replace your current practice data. Continue?')) {
                            practiceData = importedData;
                            saveUserData();
                            renderApp();
                            alert('Data imported successfully!');
                        }
                    } else {
                        alert('Invalid data format. Import failed.');
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }
    }

    // Event Listeners and App Initialization
    document.addEventListener('DOMContentLoaded', () => {
        // Firebase Auth State Listener
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                currentUser = user.uid;
                document.getElementById('current-user-display').textContent = user.email;
                loadUserData()
                    .then(() => showApp());
            } else {
                // User is signed out
                currentUser = null;
                showLoginScreen();
            }
        });
        
        // Authentication Form Listeners
        document.getElementById('show-signup').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('signup-form').style.display = 'block';
        });
        
        document.getElementById('show-login').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('signup-form').style.display = 'none';
        });
        
        // Login button
        document.getElementById('login-btn').addEventListener('click', function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showAuthMessage('Please enter both email and password', 'error');
                return;
            }
            
            // Show loading state
            this.textContent = 'Logging in...';
            this.disabled = true;
            
            // Attempt login
            signIn(email, password)
                .then(() => {
                    // Reset button
                    this.textContent = 'Login';
                    this.disabled = false;
                    clearAuthMessage();
                })
                .catch(error => {
                    // Reset button
                    this.textContent = 'Login';
                    this.disabled = false;
                    
                    // Show error
                    showAuthMessage(error.message, 'error');
                });
        });
        
        // Signup button
       document.getElementById('signup-btn').addEventListener('click', function() {
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    
    console.log("Signup button clicked", email);
    
    if (!email || !password) {
        showAuthMessage('Please enter both email and password', 'error');
        return;
    }
    
    if (password.length < 6) {
        showAuthMessage('Password must be at least 6 characters', 'error');
        return;
    }
    
    // Show loading state
    this.textContent = 'Creating account...';
    this.disabled = true;
    
    // Attempt signup
    signUp(email, password)
        .then(() => {
            // Reset button
            this.textContent = 'Create Account';
            this.disabled = false;
            
            // Show success
            showAuthMessage('Account created! Logging you in...', 'success');
            
            // Clear form
            document.getElementById('signup-email').value = '';
            document.getElementById('signup-password').value = '';
        })
        .catch(error => {
            // Reset button
            this.textContent = 'Create Account';
            this.disabled = false;
            
            // Show error with specific message
            showAuthMessage('Error: ' + error.message, 'error');
        });
});
        
        // Logout button
        document.getElementById('logout-btn').addEventListener('click', function() {
            signOut()
                .then(() => {
                    // Logic handled by auth state listener
                })
                .catch(error => {
                    console.error('Error signing out:', error);
                });
        });
        
        // Timer setup
        setupTimer();
        
        // Duration input
        document.getElementById('duration').addEventListener('change', updateTimeAllocationSliders);
        
        // Form submission
        document.getElementById('practice-form').addEventListener('submit', savePracticeSession);
        
        // Add technique button
        document.getElementById('add-technique-btn').addEventListener('click', addTechnique);
        
        // Add song button
        document.getElementById('add-song-btn').addEventListener('click', addSong);
        
        // Settings save button
        document.getElementById('save-settings-btn').addEventListener('click', saveSettings);
        
        // Data export/import
        document.getElementById('export-data-btn').addEventListener('click', exportData);
        document.getElementById('import-data-btn').addEventListener('click', importData);
        document.getElementById('import-file').addEventListener('change', handleFileSelect);
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Update active tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Update visible content
                const tabName = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                // Render reports if reports tab is selected
                if (tabName === 'reports') {
                    renderReports();
                }
            });
        });
    });
</script>
</body>
</html>